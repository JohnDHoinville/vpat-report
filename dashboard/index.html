<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPAT Dashboard</title>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        [x-cloak] { display: none !important; }
        
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .dashboard-container {
            min-height: 100vh;
            display: flex;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .sidebar-logo-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a202c;
            margin: 0;
        }
        
        .sidebar-subtitle {
            font-size: 0.875rem;
            color: #718096;
            margin: 0;
        }
        
        /* Navigation Styles */
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }
        
        .nav-item {
            display: block;
            width: 100%;
            padding: 0.75rem 2rem;
            color: #4a5568;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #4c51bf;
        }
        
        .nav-item i {
            width: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1a202c;
            margin: 0;
        }
        
        .page-subtitle {
            font-size: 0.875rem;
            color: #718096;
            margin: 0.25rem 0 0 0;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: #4a5568;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-connected {
            background: #48bb78;
        }
        
        .status-disconnected {
            background: #f56565;
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Component Container */
        .component-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Loading States */
        .loading-spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            text-align: center;
            color: #4a5568;
            margin-top: 1rem;
        }
        
        /* Notifications */
        .notifications-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-width: 400px;
        }
        
        .notification {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: #48bb78;
        }
        
        .notification.error {
            border-left-color: #f56565;
        }
        
        .notification.warning {
            border-left-color: #ed8936;
        }
        
        .notification.info {
            border-left-color: #4299e1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .notification-message {
            font-size: 0.875rem;
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="dashboard-container" x-data="dashboard()" x-init="init()">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <!-- Logo/Header -->
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <span>♿</span>
                    </div>
                    <div>
                        <h1 class="sidebar-title">VPAT Dashboard</h1>
                        <p class="sidebar-subtitle">Accessibility Testing</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="sidebar-nav">
                <button @click="activeTab = 'projects'" 
                        :class="activeTab === 'projects' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-folder"></i>Projects
                </button>
                <button @click="activeTab = 'authentication'" 
                        :class="activeTab === 'authentication' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-key"></i>Authentication
                </button>
                <button @click="activeTab = 'web-crawler'" 
                        :class="activeTab === 'web-crawler' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-spider"></i>Web Crawler
                </button>
                <button @click="activeTab = 'testing-sessions'" 
                        :class="activeTab === 'testing-sessions' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-tasks"></i>Testing Sessions
                </button>
                <button @click="activeTab = 'testing'" 
                        :class="activeTab === 'testing' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-robot"></i>Automated Testing
                </button>
                <button @click="activeTab = 'manual-testing'" 
                        :class="activeTab === 'manual-testing' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-hand-paper"></i>Manual Testing
                </button>
                <button @click="activeTab = 'results'" 
                        :class="activeTab === 'results' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-chart-bar"></i>Results
                </button>
                <button @click="activeTab = 'analytics'" 
                        :class="activeTab === 'analytics' ? 'nav-item active' : 'nav-item'">
                    <i class="fas fa-analytics"></i>Analytics
                </button>
            </nav>
            
            <!-- Sidebar Footer -->
            <div style="padding: 1rem 2rem; border-top: 1px solid rgba(255, 255, 255, 0.2);">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="font-size: 0.75rem; color: #4a5568; font-weight: 500;">
                        Status: <span :class="apiConnected ? 'text-green-600' : 'text-red-600'" 
                                      x-text="apiConnected ? 'Connected' : 'Disconnected'"></span>
                    </div>
                    <div style="font-size: 0.75rem; color: #718096; margin-top: 0.25rem;">
                        v2.0.0 • Modular Alpine.js
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <!-- Left: Page Title -->
                    <div>
                        <h1 class="page-title" x-text="getPageTitle()"></h1>
                        <p class="page-subtitle" x-text="getPageDescription()"></p>
                    </div>
                    
                    <!-- Right: Status & Info -->
                    <div class="header-right">
                        <!-- Connection Status -->
                        <div class="status-indicator">
                            <div :class="apiConnected ? 'status-dot status-connected' : 'status-dot status-disconnected'"></div>
                            <span x-text="apiConnected ? 'API Connected' : 'API Disconnected'"></span>
                        </div>
                        
                        <div class="status-indicator">
                            <div :class="wsConnected ? 'status-dot status-connected' : 'status-dot status-disconnected'"></div>
                            <span x-text="wsConnected ? 'Live Updates' : 'No Live Updates'"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dynamic Content Area -->
            <div class="content-area">
                <div class="component-container">
                    <!-- Loading State -->
                    <div x-show="loading" class="loading-text">
                        <div class="loading-spinner"></div>
                        <p>Loading dashboard components...</p>
                    </div>
                    
                    <!-- Projects Component -->
                    <div x-show="activeTab === 'projects' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components').projects" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Projects component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components').projects" x-html="Alpine.store('components').projects"></div>
                    </div>
                    
                    <!-- Authentication Component -->
                    <div x-show="activeTab === 'authentication' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components').authentication" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Authentication component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components').authentication" x-html="Alpine.store('components').authentication"></div>
                    </div>
                    
                    <!-- Web Crawler Component -->
                    <div x-show="activeTab === 'web-crawler' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components')['web-crawler']" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Web Crawler component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components')['web-crawler']" x-html="Alpine.store('components')['web-crawler']"></div>
                    </div>
                    
                    <!-- Testing Sessions Component -->
                    <div x-show="activeTab === 'testing-sessions' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components')['testing-sessions']" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Testing Sessions component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components')['testing-sessions']" x-html="Alpine.store('components')['testing-sessions']"></div>
                    </div>
                    
                    <!-- Automated Testing Component -->
                    <div x-show="activeTab === 'testing' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components').testing" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Automated Testing component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components').testing" x-html="Alpine.store('components').testing"></div>
                    </div>
                    
                    <!-- Manual Testing Component -->
                    <div x-show="activeTab === 'manual-testing' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components')['manual-testing']" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Manual Testing component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components')['manual-testing']" x-html="Alpine.store('components')['manual-testing']"></div>
                    </div>
                    
                    <!-- Results Component -->
                    <div x-show="activeTab === 'results' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components').results" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Results component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components').results" x-html="Alpine.store('components').results"></div>
                    </div>
                    
                    <!-- Analytics Component -->
                    <div x-show="activeTab === 'analytics' && !loading">
                        <!-- Debug info -->
                        <div x-show="!Alpine.store('components').analytics" class="text-center py-8">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Loading Analytics component...</p>
                        </div>
                        <!-- Actual component content -->
                        <div x-show="Alpine.store('components').analytics" x-html="Alpine.store('components').analytics"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notifications Container -->
        <div class="notifications-container">
            <div x-show="notification.show" 
                 :class="`notification ${notification.type} show`"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="transform translate-x-full"
                 x-transition:enter-end="transform translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="transform translate-x-0"
                 x-transition:leave-end="transform translate-x-full">
                <div class="notification-title" x-text="notification.title"></div>
                <div class="notification-message" x-text="notification.message"></div>
            </div>
        </div>
    </div>

    <!-- Load Components -->
    <div id="auth-modals-component"></div>
    <div id="project-modals-component"></div>
    
    <!-- Main Dashboard JavaScript - Now Inline -->
    
    <script>
        // Initialize Alpine stores before anything else
        document.addEventListener('alpine:init', () => {
            console.log('🔧 Initializing Alpine stores...');
            
            // Component Loader System
            Alpine.store('components', {
            projects: null,
            authentication: null,
            'web-crawler': null,
            'testing-sessions': null,
            'testing': null,
            'manual-testing': null,
            'results': null,
            'analytics': null,
            
            async loadComponent(name) {
                try {
                    // Try to load from views directory first, then components
                    let response = await fetch(`views/${name}.html`);
                    if (!response.ok) {
                        response = await fetch(`components/${name}-tab.html`);
                    }
                    
                    if (response.ok) {
                        this[name] = await response.text();
                        console.log(`✅ Loaded component: ${name}`, this[name].substring(0, 100) + '...');
                    } else {
                        console.warn(`Failed to load component: ${name}`);
                        // Fallback content
                        this[name] = `<div class="space-y-6">
                            <h2 class="text-2xl font-bold text-gray-900">${name.charAt(0).toUpperCase() + name.slice(1)}</h2>
                            <p class="text-gray-600">This component is being developed...</p>
                        </div>`;
                    }
                } catch (error) {
                    console.error(`Error loading component ${name}:`, error);
                }
            }
        });
        
        // Load modal components
        async function loadModalComponents() {
            console.log('🔧 Modal loading temporarily disabled for testing');
            // Temporarily disabled to eliminate Alpine.js errors
            return;
        }
        
        // Load components on page ready
        document.addEventListener('DOMContentLoaded', async () => {
            const componentStore = Alpine.store('components');
            
            // Load all components
            await Promise.all([
                componentStore.loadComponent('projects'),
                componentStore.loadComponent('authentication'),
                componentStore.loadComponent('web-crawler'),
                componentStore.loadComponent('testing-sessions'),
                componentStore.loadComponent('testing'),
                componentStore.loadComponent('manual-testing'),
                componentStore.loadComponent('results'),
                componentStore.loadComponent('analytics'),
                loadModalComponents()
                         ]);
             
                          console.log('✅ All components loaded');
             console.log('📊 Components state:', Alpine.store('components'));
         });
         
         }); // Close alpine:init
        
        // Alpine.js Dashboard Extensions
        function dashboard() {
            return {
                // Core state
                activeTab: 'projects',
                loading: true,
                apiConnected: false,
                wsConnected: false,
                selectedProject: null,
                
                // Authentication state
                isAuthenticated: false,
                user: null,
                token: null,
                
                // Modal states - Authentication Modals
                showLogin: false,
                showProfile: false,
                showChangePassword: false,
                showSessions: false,
                showSetupAuth: false,
                
                // Project Modals
                showCreateProject: false,
                showDeleteProject: false,
                showDeleteDiscovery: false,
                showDeleteSession: false,
                
                // Data
                projects: [],
                sessions: [],
                
                // Form Data
                loginForm: {
                    username: '',
                    password: ''
                },
                
                profileForm: {
                    full_name: '',
                    email: ''
                },
                
                passwordForm: {
                    current_password: '',
                    new_password: '',
                    confirm_password: ''
                },
                
                newProject: {
                    name: '',
                    description: '',
                    primary_url: '',
                    compliance_standard: 'wcag_2_1_aa'
                },
                
                projectToDelete: null,
                
                // Error states
                loginError: null,
                profileError: null,
                passwordError: null,
                
                // Notification system
                notification: {
                    show: false,
                    type: 'info',
                    title: '',
                    message: ''
                },
                
                // Page title and description helpers
                getPageTitle() {
                    const titles = {
                        'projects': 'Projects Overview',
                        'authentication': 'Authentication Configuration',
                        'web-crawler': 'Web Crawler',
                        'testing-sessions': 'Testing Sessions',
                        'testing': 'Automated Testing',
                        'manual-testing': 'Manual Testing',
                        'results': 'Results & Analytics',
                        'analytics': 'Advanced Analytics'
                    };
                    return titles[this.activeTab] || 'Dashboard';
                },
                
                getPageDescription() {
                    const descriptions = {
                        'projects': 'Manage your accessibility testing projects and their configurations',
                        'authentication': 'Configure SAML, SSO, and user authentication methods',
                        'web-crawler': 'Advanced Playwright-based crawling with authentication support',
                        'testing-sessions': 'Manage and monitor your compliance testing sessions',
                        'testing': 'Run automated accessibility tests (axe, pa11y, lighthouse)',
                        'manual-testing': 'Conduct comprehensive manual accessibility evaluations',
                        'results': 'View test results and compliance analytics',
                        'analytics': 'Advanced reporting and trend analysis'
                    };
                    return descriptions[this.activeTab] || 'Manage and monitor accessibility compliance testing';
                },
                
                // Initialization
                async init() {
                    console.log('🚀 Dashboard initializing...');
                    
                    // Wait for component store to be ready
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    // Check API connection
                    try {
                        const response = await fetch('http://localhost:3001/api/health');
                        if (response.ok) {
                            this.apiConnected = true;
                            console.log('✅ API connected');
                        } else {
                            this.apiConnected = false;
                            console.log('❌ API disconnected - HTTP', response.status);
                        }
                    } catch (error) {
                        this.apiConnected = false;
                        console.log('❌ API disconnected -', error.message);
                    }
                    
                    // Load initial data
                    await this.loadProjects();
                    
                    this.loading = false;
                    console.log('✅ Dashboard initialized');
                },
                
                // Project management
                async loadProjects() {
                    try {
                        const response = await fetch('http://localhost:3001/api/projects');
                        if (response.ok) {
                            const data = await response.json();
                            this.projects = data.data || data.projects || [];
                            console.log(`📁 Loaded ${this.projects.length} projects`);
                        } else {
                            this.projects = [];
                            console.error('Failed to load projects: HTTP', response.status);
                        }
                    } catch (error) {
                        console.error('Failed to load projects:', error);
                        this.projects = [];
                    }
                },
                
                // Project CRUD operations
                async createProject() {
                    try {
                        if (!this.newProject.name.trim()) {
                            this.addNotification('error', 'Validation Error', 'Project name is required');
                            return;
                        }
                        
                        const response = await fetch('http://localhost:3001/api/projects', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.newProject)
                        });
                        
                        if (response.ok) {
                            this.addNotification('success', 'Success', 'Project created successfully');
                            await this.loadProjects();
                            this.showCreateProject = false;
                            this.resetNewProject();
                        } else {
                            this.addNotification('error', 'Error', 'Failed to create project');
                        }
                    } catch (error) {
                        console.error('Error creating project:', error);
                        this.addNotification('error', 'Error', 'Failed to create project');
                    }
                },
                
                resetNewProject() {
                    this.newProject = {
                        name: '',
                        description: '',
                        primary_url: '',
                        compliance_standard: 'wcag_2_1_aa'
                    };
                },
                
                addNotification(type, title, message) {
                    // Simple notification implementation
                    console.log(`${type.toUpperCase()}: ${title} - ${message}`);
                    this.notification = {
                        show: true,
                        type: type,
                        title: title,
                        message: message
                    };
                    // Auto-hide after 5 seconds
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 5000);
                },
                
                // Authentication methods
                async login() {
                    try {
                        this.loading = true;
                        this.loginError = null;
                        
                        const response = await fetch('http://localhost:3001/api/auth/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.loginForm)
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.user = data.user;
                            this.token = data.token;
                            this.isAuthenticated = true;
                            this.showLogin = false;
                            this.addNotification('success', 'Login Successful', 'Welcome back!');
                        } else {
                            const error = await response.json();
                            this.loginError = error.message || 'Login failed';
                        }
                    } catch (error) {
                        this.loginError = 'Network error. Please try again.';
                    } finally {
                        this.loading = false;
                    }
                },
                
                async updateProfile() {
                    try {
                        this.loading = true;
                        this.profileError = null;
                        
                        const response = await fetch('http://localhost:3001/api/auth/profile', {
                            method: 'PUT',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify(this.profileForm)
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.user = data.user;
                            this.addNotification('success', 'Profile Updated', 'Your profile has been updated successfully');
                        } else {
                            const error = await response.json();
                            this.profileError = error.message || 'Profile update failed';
                        }
                    } catch (error) {
                        this.profileError = 'Network error. Please try again.';
                    } finally {
                        this.loading = false;
                    }
                },
                
                async changePassword() {
                    try {
                        this.loading = true;
                        this.passwordError = null;
                        
                        if (this.passwordForm.new_password !== this.passwordForm.confirm_password) {
                            this.passwordError = 'New passwords do not match';
                            this.loading = false;
                            return;
                        }
                        
                        const response = await fetch('http://localhost:3001/api/auth/change-password', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                current_password: this.passwordForm.current_password,
                                new_password: this.passwordForm.new_password
                            })
                        });
                        
                        if (response.ok) {
                            this.showChangePassword = false;
                            this.passwordForm = { current_password: '', new_password: '', confirm_password: '' };
                            this.addNotification('success', 'Password Changed', 'Your password has been updated successfully');
                        } else {
                            const error = await response.json();
                            this.passwordError = error.message || 'Password change failed';
                        }
                    } catch (error) {
                        this.passwordError = 'Network error. Please try again.';
                    } finally {
                        this.loading = false;
                    }
                },
                
                editProject(project) {
                    console.log('Edit project:', project);
                },
                
                deleteProject(project) {
                    console.log('Delete project:', project);
                },
                
                // Utility functions
                getStatusBadgeClass(status) {
                    const classes = {
                        'active': 'bg-green-100 text-green-800',
                        'planning': 'bg-blue-100 text-blue-800',
                        'in_progress': 'bg-yellow-100 text-yellow-800',
                        'completed': 'bg-green-100 text-green-800',
                        'cancelled': 'bg-gray-100 text-gray-800'
                    };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                },
                
                formatDate(dateString) {
                    if (!dateString) return 'N/A';
                    return new Date(dateString).toLocaleDateString();
                },
                
                selectProject(project) {
                    this.selectedProject = project;
                    console.log('Selected project:', project);
                    this.addNotification('info', 'Project Selected', `Now working with ${project.name}`);
                },
            };
        }
    </script>
</body>
</html> 